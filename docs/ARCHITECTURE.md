# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜æ™ºèƒ½ç†ç–—ç®¡ç†ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€æŠ€æœ¯é€‰å‹å’Œæ¨¡å—äº¤äº’å…³ç³»ã€‚

---

## ğŸ“‹ ç›®å½•

- [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
- [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [æ¨¡å—è®¾è®¡](#æ¨¡å—è®¾è®¡)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)

---

## ğŸ¯ æ•´ä½“æ¶æ„

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚                     (React Frontend)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Dashboard â”‚  â”‚Appointmentâ”‚ â”‚Exercise  â”‚  â”‚Treatment â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                          â”‚
â”‚                  (Django REST Framework)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Views   â”‚  â”‚Serializersâ”‚ â”‚Permissionsâ”‚ â”‚Validatorsâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               Business Services                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Action      â”‚  â”‚ Appointment â”‚  â”‚Notification â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Learning    â”‚  â”‚  Service    â”‚  â”‚  Service    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†• ORM
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Data Layer                               â”‚
â”‚                  (PostgreSQL / SQLite)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Users   â”‚  â”‚Appointmentâ”‚ â”‚Treatment â”‚  â”‚  Action  â”‚   â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ Learning â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰åç«¯åˆ†ç¦»æ¶æ„

**ä¼˜åŠ¿:**
- âœ… å‰åç«¯ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- âœ… API å¯è¢«å¤šä¸ªå®¢æˆ·ç«¯å¤ç”¨
- âœ… æ›´å¥½çš„å¯æ‰©å±•æ€§
- âœ… æ˜ç¡®çš„èŒè´£åˆ†ç¦»

**é€šä¿¡æ–¹å¼:**
- RESTful API (JSON)
- HTTP/HTTPS åè®®
- Token-based è®¤è¯

---

## ğŸ› ï¸ æŠ€æœ¯é€‰å‹

### åç«¯æ¡†æ¶ï¼šDjango + DRF

**é€‰æ‹©ç†ç”±:**
1. **å¿«é€Ÿå¼€å‘**: Django çš„"batteries included"å“²å­¦
2. **æˆç†Ÿç¨³å®š**: å¤§å‹ç¤¾åŒºå’Œä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“
3. **ORM å¼ºå¤§**: ç®€åŒ–æ•°æ®åº“æ“ä½œ
4. **RESTful æ”¯æŒ**: DRF æä¾›å®Œå–„çš„ API æ¡†æ¶
5. **å®‰å…¨æ€§**: å†…ç½® CSRFã€XSSã€SQLæ³¨å…¥é˜²æŠ¤

### å‰ç«¯æ¡†æ¶ï¼šReact

**é€‰æ‹©ç†ç”±:**
1. **ç»„ä»¶åŒ–**: ä»£ç å¤ç”¨å’Œç»´æŠ¤æ€§å¥½
2. **ç”Ÿæ€ä¸°å¯Œ**: å¤§é‡æˆç†Ÿçš„åº“å’Œå·¥å…·
3. **è™šæ‹Ÿ DOM**: é«˜æ€§èƒ½æ¸²æŸ“
4. **Hooks**: ç®€æ´çš„çŠ¶æ€ç®¡ç†
5. **ç¤¾åŒºæ´»è·ƒ**: ä¸°å¯Œçš„å­¦ä¹ èµ„æº

### UI æ¡†æ¶ï¼šMaterial-UI

**é€‰æ‹©ç†ç”±:**
1. **ç°ä»£ç¾è§‚**: Google Material Design
2. **ç»„ä»¶ä¸°å¯Œ**: å¼€ç®±å³ç”¨çš„ UI ç»„ä»¶
3. **å“åº”å¼**: è‡ªåŠ¨é€‚é…å„ç§å±å¹•
4. **å¯å®šåˆ¶**: çµæ´»çš„ä¸»é¢˜ç³»ç»Ÿ
5. **å¯è®¿é—®æ€§**: ç¬¦åˆ WCAG æ ‡å‡†

### AI/ML æŠ€æœ¯æ ˆ

#### YOLOv8-pose
**é€‰æ‹©ç†ç”±:**
- âœ… æœ€å…ˆè¿›çš„å§¿æ€æ£€æµ‹æ¨¡å‹
- âœ… å®æ—¶æ€§èƒ½ï¼ˆ30+ FPSï¼‰
- âœ… é«˜å‡†ç¡®ç‡ï¼ˆCOCO-17 keypointsï¼‰
- âœ… æ˜“äºé›†æˆï¼ˆUltralyticsï¼‰

#### DTW Algorithm
**é€‰æ‹©ç†ç”±:**
- âœ… ä¸éœ€è¦å¤§é‡è®­ç»ƒæ•°æ®
- âœ… å¯è§£é‡Šæ€§å¼ºï¼ˆè·ç¦»åº¦é‡ï¼‰
- âœ… é€‚åˆæ—¶é—´åºåˆ—å¯¹é½
- âœ… è®¡ç®—æ•ˆç‡é«˜ï¼ˆå¸¦çº¦æŸï¼‰

#### NumPy + SciPy
**é€‰æ‹©ç†ç”±:**
- âœ… é«˜æ€§èƒ½æ•°å€¼è®¡ç®—
- âœ… æˆç†Ÿçš„ç§‘å­¦è®¡ç®—åº“
- âœ… ä¸ TensorFlow/PyTorch å…¼å®¹

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ER å›¾æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CustomUser  â”‚ 1â”€â”€â”€â”€â”€â”€â”€â”€ * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (ç”¨æˆ·åŸºè¡¨)   â”‚              â”‚  Appointment â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   (é¢„çº¦)     â”‚
       â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1                            â”‚
       â”‚                              â”‚ *
       â”‚ *                            â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Patient    â”‚ 1â”€â”€â”€â”€â”€â”€â”€â”€ * â”‚  Treatment   â”‚
â”‚   (æ‚£è€…)     â”‚              â”‚  (æ²»ç–—è®¡åˆ’)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1                            â”‚ 1
       â”‚                              â”‚
       â”‚ *                            â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MedicalHistoryâ”‚              â”‚TreatmentExer â”‚
â”‚  (ç—…å†)      â”‚              â”‚cise (ç»ƒä¹ )   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ *
                                     â”‚
                                     â”‚ 1
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Exercise   â”‚
                              â”‚   (ç»ƒä¹ åº“)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        Action Learning ç›¸å…³è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 1 â”€â”€â”€â”€â”€â”€ * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Action    â”‚              â”‚ActionSample  â”‚
â”‚  (åŠ¨ä½œå®šä¹‰)  â”‚              â”‚ (æ¼”ç¤ºæ ·æœ¬)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚ 
       â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 1 â”€â”€â”€â”€â”€â”€ * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ActionTemplateâ”‚              â”‚ActionSession â”‚
â”‚  (åŠ¨ä½œæ¨¡æ¿)  â”‚              â”‚ (æµ‹è¯•ä¼šè¯)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ•°æ®è¡¨

#### ç”¨æˆ·ç›¸å…³

**CustomUser**
```sql
- id: Primary Key
- username: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- email: é‚®ç®±
- role: è§’è‰²ï¼ˆadmin/therapist/patientï¼‰
- is_active: æ˜¯å¦æ¿€æ´»
- created_at: åˆ›å»ºæ—¶é—´
```

#### æ‚£è€…ç›¸å…³

**Patient**
```sql
- id: Primary Key
- user_id: Foreign Key â†’ CustomUser
- date_of_birth: å‡ºç”Ÿæ—¥æœŸ
- phone: ç”µè¯
- address: åœ°å€
- emergency_contact: ç´§æ€¥è”ç³»äºº
```

**MedicalHistory**
```sql
- id: Primary Key
- patient_id: Foreign Key â†’ Patient
- notes: ç—…å†è®°å½•
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### é¢„çº¦ç›¸å…³

**Appointment**
```sql
- id: Primary Key
- patient_id: Foreign Key â†’ Patient
- therapist_id: Foreign Key â†’ CustomUser
- scheduled_at: é¢„çº¦æ—¶é—´
- duration: æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
- status: çŠ¶æ€ï¼ˆpending/confirmed/completed/cancelledï¼‰
- patient_message: æ‚£è€…ç•™è¨€
- cancel_reason: å–æ¶ˆåŸå› 
- cancelled_at: å–æ¶ˆæ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
```

**UnavailableSlot**
```sql
- id: Primary Key
- therapist_id: Foreign Key â†’ CustomUser
- start_time: å¼€å§‹æ—¶é—´
- end_time: ç»“æŸæ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
```

#### æ²»ç–—ç›¸å…³

**Treatment**
```sql
- id: Primary Key
- patient_id: Foreign Key â†’ Patient
- therapist_id: Foreign Key â†’ CustomUser
- start_date: å¼€å§‹æ—¥æœŸ
- end_date: ç»“æŸæ—¥æœŸ
- goal_notes: æ²»ç–—ç›®æ ‡
- status: çŠ¶æ€ï¼ˆactive/completed/cancelledï¼‰
```

**TreatmentExercise**
```sql
- id: Primary Key
- treatment_id: Foreign Key â†’ Treatment
- exercise_id: Foreign Key â†’ Exercise
- notes: å¤‡æ³¨
- order: é¡ºåº
```

**Exercise**
```sql
- id: Primary Key
- exercise_name: ç»ƒä¹ åç§°
- instructions: è¯´æ˜
- body_part: èº«ä½“éƒ¨ä½
- difficulty: éš¾åº¦ï¼ˆbeginner/intermediate/advancedï¼‰
- category: åˆ†ç±»
- detection_rules: æ£€æµ‹è§„åˆ™ï¼ˆJSONï¼‰
```

#### Action Learning ç›¸å…³

**Action** (åŠ¨ä½œå®šä¹‰)
```sql
- id: Primary Key
- name: åŠ¨ä½œåç§°
- description: æè¿°
- mode: æ¨¡å¼ï¼ˆ'dtw' / 'clf'ï¼‰
- params_json: å‚æ•°ï¼ˆJSONï¼‰
  â”œâ”€ thresholds: {thr_in, thr_out}
  â”œâ”€ windows: [20, 40, 56]
  â”œâ”€ feature_weights: [...]
  â”œâ”€ energy_p30, energy_p50, energy_p70
  â””â”€ median_len, band_ratio, ...
- model_path: æ¨¡å‹è·¯å¾„ï¼ˆé¢„ç•™ï¼‰
- created_by: Foreign Key â†’ CustomUser
- created_at: åˆ›å»ºæ—¶é—´
```

**ActionSample** (æ¼”ç¤ºæ ·æœ¬)
```sql
- id: Primary Key
- action_id: Foreign Key â†’ Action
- video_url: è§†é¢‘æ–‡ä»¶è·¯å¾„
- keypoints_json: å…³é”®ç‚¹æ•°æ®ï¼ˆJSONï¼‰
  â””â”€ {frame_idx: {keypoint_name: {xy: [x,y], conf: float}}}
- fps: å¸§ç‡
- weak_labels_json: è‡ªåŠ¨åˆ†æ®µæ ‡ç­¾
- refined_labels_json: ç²¾ç‚¼æ ‡ç­¾
- created_at: åˆ›å»ºæ—¶é—´
```

**ActionTemplate** (åŠ¨ä½œæ¨¡æ¿)
```sql
- id: Primary Key
- action_id: Foreign Key â†’ Action
- seq_json: åºåˆ—æ•°æ®ï¼ˆJSONï¼‰
  â”œâ”€ T: æ—¶é—´é•¿åº¦
  â”œâ”€ F: ç‰¹å¾ç»´åº¦
  â””â”€ data: [[f1,f2,...], ...]
- length: é•¿åº¦
- feature_dim: ç‰¹å¾ç»´åº¦
- created_at: åˆ›å»ºæ—¶é—´
```

**ActionSession** (æµ‹è¯•ä¼šè¯)
```sql
- id: Primary Key
- action_id: Foreign Key â†’ Action
- reps: è¯†åˆ«çš„é‡å¤æ¬¡æ•°
- started_at: å¼€å§‹æ—¶é—´
- metrics_json: æ€§èƒ½æŒ‡æ ‡ï¼ˆJSONï¼‰
```

---

## ğŸ”„ æ¨¡å—è®¾è®¡

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—

**èŒè´£:**
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- è§’è‰²æƒé™æ§åˆ¶
- ç”¨æˆ·èµ„æ–™ç®¡ç†

**ç»„ä»¶:**
- `CustomUser` Model
- `UserViewSet` API
- `UserAccountManagement` å‰ç«¯ç»„ä»¶

**æƒé™è®¾è®¡:**
```python
Roles:
- Admin: å…¨éƒ¨æƒé™
- Therapist: 
  âœ… æŸ¥çœ‹/ç¼–è¾‘æ‚£è€…ä¿¡æ¯
  âœ… ç®¡ç†é¢„çº¦
  âœ… åˆ›å»ºæ²»ç–—è®¡åˆ’
  âŒ ç”¨æˆ·ç®¡ç†
- Patient:
  âœ… æŸ¥çœ‹è‡ªå·±çš„ä¿¡æ¯
  âœ… é¢„çº¦ç®¡ç†
  âœ… æŸ¥çœ‹æ²»ç–—è®¡åˆ’
  âŒ å…¶ä»–æ‚£è€…ä¿¡æ¯
```

### 2. é¢„çº¦ç³»ç»Ÿæ¨¡å—

**èŒè´£:**
- é¢„çº¦ CRUD
- æ—¥ç¨‹ç®¡ç†
- å†²çªæ£€æµ‹

**æ¶æ„:**
```
Frontend (React Big Calendar)
    â†“ REST API
Django Views (appointment_views.py)
    â†“ Business Logic
Appointment Service
    â†“ ORM
Database (Appointment, UnavailableSlot)
```

**çŠ¶æ€æœº:**
```
pending â†’ confirmed â†’ completed
   â†“          â†“
cancelled  cancelled
```

**[è¯¦ç»†æ–‡æ¡£ â†’](MODULES/APPOINTMENT_SYSTEM.md)**

### 3. æ‚£è€…ä¿¡æ¯ç®¡ç†æ¨¡å—

**èŒè´£:**
- æ‚£è€…æ¡£æ¡ˆ CRUD
- ç—…å†ç®¡ç†
- æ²»ç–—å†å²æŸ¥è¯¢

**æ•°æ®æ¨¡å‹:**
- Patient (1) â†â†’ (1) CustomUser
- Patient (1) â†â†’ (*) MedicalHistory
- Patient (1) â†â†’ (*) Treatment

### 4. æ²»ç–—è®¡åˆ’ç®¡ç†æ¨¡å—

**èŒè´£:**
- æ²»ç–—è®¡åˆ’åˆ›å»ºå’Œç®¡ç†
- ç»ƒä¹ åˆ†é…
- è¿›åº¦è¿½è¸ª

**ç»„ä»¶äº¤äº’:**
```
Therapist â†’ Create Treatment Plan
         â†“
    Assign Exercises (from Exercise Library)
         â†“
    Patient View Treatment
         â†“
    Patient Perform Exercises (with AI Recognition)
         â†“
    Therapist Review Progress
```

### 5. è¿åŠ¨ç»ƒä¹ ç®¡ç†æ¨¡å—

**èŒè´£:**
- ç»ƒä¹ åº“ç®¡ç†
- ç»ƒä¹ é…ç½®
- æ£€æµ‹è§„åˆ™è®¾ç½®

**ä¸¤ç§æ¨¡å¼:**
1. **Legacy Mode**: åŸºäºè§„åˆ™çš„æ£€æµ‹
   - é…ç½® detection_rules (JSON)
   - è§’åº¦/è·ç¦»/ä½ç½®è§„åˆ™
   
2. **AI Mode**: Action Learning
   - å½•åˆ¶æ¼”ç¤ºè§†é¢‘
   - è‡ªåŠ¨å­¦ä¹ æ¨¡å¼

### 6. **â­ Action Learning æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰**

è¯¦è§ [Action Learning æŠ€æœ¯æ¶æ„](#action-learning-æŠ€æœ¯æ¶æ„) éƒ¨åˆ†

### 7. é€šçŸ¥ç³»ç»Ÿæ¨¡å—

**èŒè´£:**
- å®æ—¶é€šçŸ¥
- é¢„çº¦æé†’

**æ¶æ„:**
```
Event Trigger (é¢„çº¦åˆ›å»º/ä¿®æ”¹)
    â†“
Notification Service
    â†“
Frontend Polling/WebSocket (æœªæ¥)
    â†“
Display Notification
```

---

## ğŸ¤– Action Learning æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TRAINING PIPELINE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    Video Input (3-5 repetitions)
                            â†“
    YOLOv8 Pose Detection (17 keypoints Ã— N frames)
                            â†“
    Adaptive Normalization (mode detection, root/scale)
                            â†“
    Feature Engineering (32 â†’ 64 dimensions)
                            â†“
    Auto Segmentation (velocity + energy based)
                            â†“
    Template Building (time normalization)
                            â†“
    Threshold Estimation (DTW statistics)
                            â†“
    Save to Database (Action, Templates, Thresholds)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  INFERENCE PIPELINE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    Live Camera Frame
                            â†“
    YOLOv8 Pose Detection
                            â†“
    Adaptive Normalization (sticky root/scale)
                            â†“
    Feature Extraction + Velocity
                            â†“
    Multi-Window DTW Distance Calculation
                            â†“
    Motion Energy Estimation
                            â†“
    Hysteresis State Machine (OUT/IN transitions)
                            â†“
    Repetition Count Output
```

### æœåŠ¡å±‚æ¶æ„

```
backend/api/services/
â”œâ”€â”€ pipeline.py           # ä¸»ç®¡é“ï¼šåè°ƒæ‰€æœ‰æ­¥éª¤
â”‚   â”œâ”€â”€ finalize_action_from_video()
â”‚   â”œâ”€â”€ setup_action_for_inference()
â”‚   â””â”€â”€ process_realtime_frame()
â”‚
â”œâ”€â”€ feat.py              # ç‰¹å¾å·¥ç¨‹
â”‚   â”œâ”€â”€ normalize_keypoints()     # è‡ªé€‚åº”å½’ä¸€åŒ–
â”‚   â”œâ”€â”€ frame_features()          # æå– 32 ç»´ç‰¹å¾
â”‚   â”œâ”€â”€ add_velocity_features()   # æ·»åŠ é€Ÿåº¦ç‰¹å¾
â”‚   â””â”€â”€ z_score_normalize()       # Z-score å½’ä¸€åŒ–
â”‚
â”œâ”€â”€ segmentation.py      # è‡ªåŠ¨åˆ†æ®µ
â”‚   â”œâ”€â”€ auto_segment()            # è‡ªåŠ¨åˆ†å‰²ç‰‡æ®µ
â”‚   â”œâ”€â”€ build_templates()         # æ„å»ºæ¨¡æ¿
â”‚   â””â”€â”€ estimate_thresholds()     # ä¼°è®¡é˜ˆå€¼
â”‚
â”œâ”€â”€ dtw.py              # DTW æ ¸å¿ƒç®—æ³•
â”‚   â”œâ”€â”€ dtw_distance()            # DTW è·ç¦»è®¡ç®—
â”‚   â””â”€â”€ lb_keogh_lower_bound()    # ä¸‹ç•Œä¼˜åŒ–
â”‚
â””â”€â”€ dtw_recognition.py  # å®æ—¶è¯†åˆ«
    â”œâ”€â”€ DTWRecognizer             # è¯†åˆ«å™¨ç±»
    â”œâ”€â”€ initialize_recognizer()   # åˆå§‹åŒ–
    â””â”€â”€ dtw_infer_update()        # å®æ—¶æ›´æ–°
```

### ç®—æ³•ç»„ä»¶

#### 1. è‡ªé€‚åº”å½’ä¸€åŒ–å¼•æ“
```python
Input: Raw Keypoints (17 Ã— [x, y, conf])
Output: Normalized Keypoints (scale-invariant)

Components:
- Mode Detector (full/upper/lower body)
- Root Selector (hip/shoulder center)
- Scale Calculator (shoulder/hip width)
- EMA Smoother (temporal stability)
```

#### 2. ç‰¹å¾æå–å¼•æ“
```python
Input: Normalized Keypoints
Output: 64-D Feature Vector

Features:
- Joint Angles (8D): shoulder/elbow/hip/knee
- Torso Angles (2D): tilt/lean
- Relative Heights (8D): wrist/elbow/knee to shoulder/hip
- Lateral Displacements (8D): x-axis offsets
- Cross-body Distances (6D): wrist/elbow/shoulder/hip/knee/ankle
- Velocity Features (32D): first-order temporal derivatives
```

#### 3. DTW åŒ¹é…å¼•æ“
```python
Input: Query Sequence [T_q, 64], Templates [M Ã— [T_t, 64]]
Output: Min DTW Distance

Optimizations:
- Sakoe-Chiba Band Constraint (15% bandwidth)
- LB_Keogh Lower Bound Pruning
- Feature Weighting (discriminability/stability)
- Multi-Window Matching (3 window sizes)
```

#### 4. æ»å›çŠ¶æ€æœº
```python
States: OUT â†” IN

Transitions:
OUT â†’ IN:
  âœ… cooldown == 0
  âœ… rearmed_ready
  âœ… distance_smooth â‰¤ thr_in (0.75 Ã— median)
  âœ… motion_energy â‰¥ energy_p50 (NEW)
  
IN â†’ OUT:
  âœ… distance_raw â‰¥ thr_out (1.35 Ã— median)
  OR z_score > 1.9
  OR motion_energy < energy_p30

Parameters (OPTIMIZED):
- thr_in = 0.75 Ã— median (wider gap)
- thr_out = 1.35 Ã— median
- cooldown = 15-20 frames (extended)
- energy_p50 gate (NEW)
```

---

## ğŸ“¡ æ•°æ®æµ

### ç”¨æˆ·ç™»å½•æµç¨‹

```
Frontend Login Form
    â†“ POST /api/login/ {username, password}
Django Authentication Backend
    â†“ Validate Credentials
    â†“ Generate Token
Database (æŸ¥è¯¢ CustomUser)
    â†“ Return User Data + Token
Frontend
    â†“ Store Token in localStorage
    â†“ Redirect to Dashboard
```

### é¢„çº¦åˆ›å»ºæµç¨‹

```
Frontend Calendar
    â†“ POST /api/appointments/ {patient, therapist, time, ...}
Appointment View
    â†“ Validate Data (Serializer)
    â†“ Check Conflicts (Business Logic)
Database
    â†“ Save Appointment
    â†“ Trigger Notification
Frontend
    â†“ Refresh Calendar
    â†“ Show Success Message
```

### Action Learning è®­ç»ƒæµç¨‹

```
Frontend Wizard
    â†“ Step 1: Create Action
    â†“ POST /api/actions/create/ {name, description}
Backend
    â†“ Save Action
    â†“ Return action_id
    
Frontend
    â†“ Step 2: Record Demo Video
    â†“ POST /api/actions/{id}/record/ {video/keypoints}
Backend
    â†“ Save ActionSample
    
Frontend
    â†“ Step 3: Finalize
    â†“ POST /api/actions/{id}/finalize/
Backend (pipeline.py)
    â†“ Extract Keypoints
    â†“ Normalize â†’ Features â†’ Segment â†’ Templates
    â†“ Estimate Thresholds
    â†“ Save ActionTemplates
    â†“ Return Results
Frontend
    â†“ Show Success
    â†“ Ready for Inference
```

### Action Learning è¯†åˆ«æµç¨‹

```
Frontend Real-time Test
    â†“ POST /api/actions/{id}/setup/
Backend
    â†“ Initialize DTW Recognizer
    â†“ Load Templates
    â†“ Return Setup Status
    
Frontend (æ¯å¸§ï¼Œ10 FPS)
    â†“ Capture Frame
    â†“ POST /api/infer/stream/ {frame}
Backend
    â†“ YOLOv8 Pose Detection
    â†“ Feature Extraction
    â†“ DTW Distance Calculation
    â†“ State Machine Update
    â†“ Return {state, reps, distance}
Frontend
    â†“ Update UI
    â†“ Display Count
    â†“ Draw Chart
```

---

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æœºåˆ¶

**Token-based Authentication:**
```
1. User Login â†’ Server validates â†’ Generate Token
2. Client stores Token (localStorage)
3. Every API request includes Token in Header
4. Server validates Token â†’ Allow/Deny
```

### æƒé™æ§åˆ¶

**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC):**

```python
# Django REST Framework Permissions

class IsAdminUser(permissions.BasePermission):
    def has_permission(self, request, view):
        return request.user.role == 'admin'

class IsTherapistOrAdmin(permissions.BasePermission):
    def has_permission(self, request, view):
        return request.user.role in ['admin', 'therapist']

class IsPatientOwner(permissions.BasePermission):
    def has_object_permission(self, request, view, obj):
        return obj.patient.user == request.user
```

### æ•°æ®å®‰å…¨

1. **å¯†ç åŠ å¯†**: Django çš„ PBKDF2 ç®—æ³•
2. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶ä½¿ç”¨ SSL
3. **CSRF ä¿æŠ¤**: Django å†…ç½® CSRF token
4. **SQL æ³¨å…¥é˜²æŠ¤**: ORM è‡ªåŠ¨è½¬ä¹‰
5. **XSS é˜²æŠ¤**: React è‡ªåŠ¨è½¬ä¹‰

### æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```python
# é™åˆ¶æ–‡ä»¶ç±»å‹
ALLOWED_VIDEO_EXTENSIONS = ['.mp4', '.webm', '.avi']

# é™åˆ¶æ–‡ä»¶å¤§å°
MAX_VIDEO_SIZE = 100 * 1024 * 1024  # 100 MB

# æ–‡ä»¶å­˜å‚¨è·¯å¾„
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
MEDIA_URL = '/media/'
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
```python
# ä½¿ç”¨ select_related å‡å°‘æŸ¥è¯¢æ¬¡æ•°
appointments = Appointment.objects.select_related('patient', 'therapist').all()

# ä½¿ç”¨ prefetch_related ä¼˜åŒ–åå‘æŸ¥è¯¢
actions = Action.objects.prefetch_related('samples', 'templates').all()
```

2. **ç¼“å­˜ç­–ç•¥**
```python
# Redis ç¼“å­˜è¯†åˆ«å™¨çŠ¶æ€
from django.core.cache import cache

cache.set('recognizer_state', recognizer_data, timeout=3600)
```

3. **å¼‚æ­¥ä»»åŠ¡**
```python
# ä½¿ç”¨ Celery å¤„ç†è€—æ—¶ä»»åŠ¡
@celery_app.task
def process_video_async(action_id):
    finalize_action_from_video(action_id)
```

### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```javascript
// æ‡’åŠ è½½ç»„ä»¶
const RealTimeTest = React.lazy(() => import('./RealTimeTest'));
```

2. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**
```javascript
// ä½¿ç”¨ useCallback é¿å…é‡æ¸²æŸ“
const handleClick = useCallback(() => {
  // ...
}, [dependencies]);
```

3. **è™šæ‹ŸåŒ–é•¿åˆ—è¡¨**
```javascript
// ä½¿ç”¨ react-window æ¸²æŸ“å¤§é‡æ•°æ®
import { FixedSizeList } from 'react-window';
```

### AI ç®—æ³•ä¼˜åŒ–

1. **DTW å¸¦çº¦æŸ**: 6.7Ã— åŠ é€Ÿ
2. **LB_Keogh ä¸‹ç•Œ**: æå‰å‰ªæ
3. **å¤šçª—å£å¹¶è¡Œ**: è‡ªé€‚åº”é€Ÿåº¦
4. **ç‰¹å¾æƒé‡**: èšç„¦é‡è¦ç‰¹å¾
5. **æ»å›ä¼˜åŒ–**: å‡å°‘ 80% æŠ–åŠ¨

---

## ğŸ”Œ API è®¾è®¡åŸåˆ™

### RESTful è®¾è®¡

```
Resources:
- /api/users/             # ç”¨æˆ·
- /api/patients/          # æ‚£è€…
- /api/appointments/      # é¢„çº¦
- /api/treatments/        # æ²»ç–—è®¡åˆ’
- /api/exercises/         # ç»ƒä¹ 
- /api/actions/           # åŠ¨ä½œï¼ˆAction Learningï¼‰

HTTP Methods:
- GET: æŸ¥è¯¢
- POST: åˆ›å»º
- PUT/PATCH: æ›´æ–°
- DELETE: åˆ é™¤
```

### å“åº”æ ¼å¼

**æˆåŠŸå“åº”:**
```json
{
  "success": true,
  "data": {...},
  "message": "Operation successful"
}
```

**é”™è¯¯å“åº”:**
```json
{
  "success": false,
  "error": "Error message",
  "details": {...}
}
```

### åˆ†é¡µ

```json
{
  "count": 100,
  "next": "http://api/resource/?page=2",
  "previous": null,
  "results": [...]
}
```

---

## ğŸ§© å¯æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

```
Load Balancer (Nginx)
    â†“
[Django Instance 1] [Django Instance 2] [Django Instance 3]
    â†“                    â†“                    â†“
            Shared PostgreSQL Database
                    â†“
              Shared Redis Cache
                    â†“
          Shared Media Storage (S3/NFS)
```

### æ¨¡å—åŒ–è®¾è®¡

æ¯ä¸ªåŠŸèƒ½æ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„ Django Appï¼Œå¯ä»¥ï¼š
- ç‹¬ç«‹æµ‹è¯•
- ç‹¬ç«‹éƒ¨ç½²
- æŒ‰éœ€åŠ è½½

### é¢„ç•™æ¥å£

**Action Learning æ¨¡å¼æ‰©å±•:**
```python
class Action:
    mode = CharField(choices=[
        ('dtw', 'DTW Recognition'),      # å½“å‰å®ç°
        ('clf', 'Deep Learning Classifier'),  # é¢„ç•™
        ('hybrid', 'Hybrid Approach')    # é¢„ç•™
    ])
    model_path = CharField()  # å­˜å‚¨ GRU/TCN æ¨¡å‹è·¯å¾„
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ¶æ„

```python
# settings.py
LOGGING = {
    'version': 1,
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'logs/django.log',
        },
        'console': {
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file', 'console'],
            'level': 'INFO',
        },
        'api.services': {
            'handlers': ['file'],
            'level': 'DEBUG',
        },
    },
}
```

### æ€§èƒ½ç›‘æ§

å…³é”®æŒ‡æ ‡ï¼š
- API å“åº”æ—¶é—´
- DTW è®¡ç®—æ—¶é—´
- è¯†åˆ«å‡†ç¡®ç‡
- ç³»ç»Ÿèµ„æºå ç”¨

---

## ğŸ”® æœªæ¥æ¶æ„æ¼”è¿›

### çŸ­æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰

1. **æ·±åº¦å­¦ä¹ é›†æˆ**
   - è®­ç»ƒ GRU/TCN åˆ†ç±»å™¨
   - æ›¿ä»£ DTW è¯†åˆ«
   
2. **å¾®æœåŠ¡åŒ–**
   - AI æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
   - ä½¿ç”¨ gRPC é€šä¿¡

3. **å®æ—¶é€šä¿¡**
   - WebSocket æ¨é€
   - å®æ—¶åä½œ

### é•¿æœŸï¼ˆ6-12 ä¸ªæœˆï¼‰

1. **äº‘åŸç”Ÿæ¶æ„**
   - Kubernetes éƒ¨ç½²
   - Docker å®¹å™¨åŒ–
   
2. **å¤šç§Ÿæˆ· SaaS**
   - å¤šè¯Šæ‰€æ”¯æŒ
   - æ•°æ®éš”ç¦»

3. **è¾¹ç¼˜è®¡ç®—**
   - ç§»åŠ¨ç«¯ AI æ¨ç†
   - å‡å°‘ç½‘ç»œå»¶è¿Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ–‡æ¡£](API_DOCUMENTATION.md) - API æ¥å£è¯¦ç»†è¯´æ˜
- [Action Learning æŠ€æœ¯æ–‡æ¡£](MODULES/ACTION_LEARNING_TECHNICAL.md) - ç®—æ³•è¯¦è§£
- [ä¼˜åŒ–æ€»ç»“](OPTIMIZATION_SUMMARY.md) - æ€§èƒ½æ”¹è¿›

---

<p align="center">
  ç³»ç»Ÿæ¶æ„æŒç»­æ¼”è¿›ä¸­... æœ€åæ›´æ–°: 2025-01-12
</p>

